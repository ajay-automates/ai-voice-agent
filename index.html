<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Supernal Voice Agent</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #08080c;
    --surface: #111118;
    --surface2: #1a1a24;
    --border: rgba(255,255,255,0.06);
    --text: #e8e8f0;
    --text2: #6b6b80;
    --accent: #6366f1;
    --accent-glow: rgba(99,102,241,0.15);
    --green: #22c55e;
    --amber: #f59e0b;
    --red: #ef4444;
  }
  *{margin:0;padding:0;box-sizing:border-box}
  body{min-height:100vh;background:var(--bg);font-family:'Outfit',sans-serif;color:var(--text);overflow-x:hidden}
  ::selection{background:var(--accent);color:#fff}

  /* Noise overlay */
  body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");pointer-events:none;z-index:9999}

  /* Ambient glow */
  .glow-orb{position:fixed;border-radius:50%;filter:blur(120px);pointer-events:none;opacity:0.4}
  .glow-1{width:600px;height:600px;background:radial-gradient(circle,rgba(99,102,241,0.12),transparent 70%);top:-200px;right:-100px}
  .glow-2{width:400px;height:400px;background:radial-gradient(circle,rgba(139,92,246,0.08),transparent 70%);bottom:-100px;left:-50px}

  .app{max-width:760px;margin:0 auto;padding:32px 24px;position:relative;z-index:1}

  /* Nav bar */
  .nav{display:flex;justify-content:space-between;align-items:center;padding:16px 0;margin-bottom:48px;border-bottom:1px solid var(--border)}
  .nav-brand{display:flex;align-items:center;gap:10px}
  .nav-logo{width:10px;height:10px;border-radius:50%;background:var(--accent);box-shadow:0 0 12px var(--accent)}
  .nav-name{font-weight:600;font-size:0.95rem;letter-spacing:-0.3px}
  .nav-badge{font-family:'IBM Plex Mono',monospace;font-size:0.6rem;letter-spacing:1.5px;color:var(--text2);background:var(--surface2);padding:4px 10px;border-radius:100px;border:1px solid var(--border)}

  /* Hero */
  .hero{text-align:center;margin-bottom:48px}
  .hero-badge{display:inline-block;font-family:'IBM Plex Mono',monospace;font-size:0.6rem;letter-spacing:3px;color:var(--accent);text-transform:uppercase;background:var(--accent-glow);border:1px solid rgba(99,102,241,0.2);padding:6px 16px;border-radius:100px;margin-bottom:20px}
  .hero h1{font-size:3.4rem;font-weight:700;letter-spacing:-2px;line-height:1.05;margin-bottom:16px;background:linear-gradient(135deg,#fff 0%,#a5a5c0 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
  .hero p{color:var(--text2);font-size:1.05rem;line-height:1.6;max-width:480px;margin:0 auto}

  /* Knowledge base card */
  .kb-card{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:20px 24px;margin-bottom:28px;transition:border-color 0.3s}
  .kb-card:focus-within{border-color:rgba(99,102,241,0.3)}
  .kb-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  .kb-title{font-family:'IBM Plex Mono',monospace;font-size:0.65rem;letter-spacing:2px;color:var(--text2);text-transform:uppercase}
  .kb-status{font-family:'IBM Plex Mono',monospace;font-size:0.6rem;display:flex;align-items:center;gap:6px}
  .kb-status .dot{width:6px;height:6px;border-radius:50%;animation:statusPulse 2s ease infinite}
  .kb-status.empty .dot{background:var(--amber)}
  .kb-status.empty{color:var(--amber)}
  .kb-status.loaded .dot{background:var(--green)}
  .kb-status.loaded{color:var(--green)}
  .kb-textarea{width:100%;background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:14px 16px;color:var(--text);font-family:'Outfit',sans-serif;font-size:0.88rem;line-height:1.6;resize:vertical;min-height:80px;transition:border-color 0.2s}
  .kb-textarea:focus{outline:none;border-color:rgba(99,102,241,0.4)}
  .kb-textarea::placeholder{color:#3a3a50}
  .kb-actions{display:flex;justify-content:flex-end;margin-top:12px}
  .btn{padding:9px 20px;border:none;border-radius:8px;font-family:'Outfit',sans-serif;font-weight:600;font-size:0.8rem;cursor:pointer;transition:all 0.2s}
  .btn-accent{background:var(--accent);color:#fff}
  .btn-accent:hover{filter:brightness(1.15);transform:translateY(-1px)}
  .btn-accent:disabled{background:#333;color:#666;cursor:not-allowed;transform:none}

  /* Chat */
  .chat{background:var(--surface);border:1px solid var(--border);border-radius:16px;min-height:220px;max-height:380px;overflow-y:auto;margin-bottom:28px;padding:6px}
  .chat::-webkit-scrollbar{width:4px}
  .chat::-webkit-scrollbar-thumb{background:#2a2a3a;border-radius:2px}
  .chat-empty{display:flex;align-items:center;justify-content:center;height:180px;color:#2a2a40;font-family:'IBM Plex Mono',monospace;font-size:0.72rem;letter-spacing:1px}
  .msg{padding:14px 18px;animation:msgIn 0.4s cubic-bezier(0.16,1,0.3,1)}
  .msg+.msg{border-top:1px solid var(--border)}
  .msg-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
  .msg-role{font-family:'IBM Plex Mono',monospace;font-size:0.58rem;letter-spacing:1.5px;text-transform:uppercase}
  .msg-role.user{color:var(--accent)}
  .msg-role.agent{color:var(--green)}
  .msg-time{font-family:'IBM Plex Mono',monospace;font-size:0.55rem;color:#3a3a50}
  .msg-body{font-size:0.92rem;line-height:1.6;color:var(--text)}
  .msg-metrics{font-family:'IBM Plex Mono',monospace;font-size:0.55rem;color:#3a3a50;margin-top:6px;display:flex;gap:16px}

  @keyframes msgIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
  @keyframes statusPulse{0%,100%{opacity:1}50%{opacity:0.4}}

  /* Mic section */
  .mic-section{text-align:center;padding:36px 0 24px}
  .orb-container{position:relative;width:120px;height:120px;margin:0 auto 20px}
  .orb-ring{position:absolute;inset:0;border-radius:50%;border:1.5px solid rgba(99,102,241,0.15);transition:all 0.4s}
  .orb-ring-2{position:absolute;inset:-12px;border-radius:50%;border:1px solid rgba(99,102,241,0.06);transition:all 0.4s}
  .orb-ring-3{position:absolute;inset:-24px;border-radius:50%;border:1px solid rgba(99,102,241,0.03);transition:all 0.4s}
  .mic-orb{width:120px;height:120px;border-radius:50%;background:var(--surface);border:2px solid rgba(99,102,241,0.25);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.3s cubic-bezier(0.16,1,0.3,1);position:relative;z-index:2;-webkit-user-select:none;user-select:none}
  .mic-orb:hover{border-color:rgba(99,102,241,0.5);box-shadow:0 0 40px var(--accent-glow)}
  .mic-orb.recording{background:var(--accent);border-color:var(--accent);box-shadow:0 0 0 12px rgba(99,102,241,0.1),0 0 60px rgba(99,102,241,0.25)}
  .mic-orb.recording~.orb-ring{border-color:rgba(99,102,241,0.3);animation:ringPulse 2s ease infinite}
  .mic-orb.recording~.orb-ring-2{border-color:rgba(99,102,241,0.15);animation:ringPulse 2s ease 0.3s infinite}
  .mic-orb.recording~.orb-ring-3{border-color:rgba(99,102,241,0.08);animation:ringPulse 2s ease 0.6s infinite}
  .mic-orb.processing{background:var(--surface2);border-color:#333;cursor:wait}
  .mic-orb svg{stroke:rgba(99,102,241,0.7);transition:all 0.3s}
  .mic-orb.recording svg{stroke:#fff}
  .mic-orb.processing svg{stroke:#555;animation:spin 1.5s linear infinite}

  @keyframes ringPulse{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.06);opacity:0.5}}
  @keyframes spin{to{transform:rotate(360deg)}}

  .mic-label{font-family:'IBM Plex Mono',monospace;font-size:0.65rem;letter-spacing:2px;color:var(--text2);text-transform:uppercase;transition:color 0.3s}
  .mic-label.recording{color:var(--accent);font-weight:500}
  .mic-label.processing{color:var(--amber)}

  /* Text input */
  .input-bar{display:flex;gap:8px;margin-top:20px}
  .input-bar input{flex:1;background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:12px 16px;color:var(--text);font-family:'Outfit',sans-serif;font-size:0.88rem;transition:border-color 0.2s}
  .input-bar input:focus{outline:none;border-color:rgba(99,102,241,0.4)}
  .input-bar input::placeholder{color:#3a3a50}
  .input-bar button{padding:12px 20px;background:var(--accent);color:#fff;border:none;border-radius:10px;font-weight:600;font-size:0.82rem;cursor:pointer;transition:all 0.2s}
  .input-bar button:hover{filter:brightness(1.15)}

  /* Footer */
  .foot{text-align:center;padding:32px 0 16px;border-top:1px solid var(--border);margin-top:40px}
  .foot-text{font-family:'IBM Plex Mono',monospace;font-size:0.55rem;letter-spacing:1.5px;color:#2a2a3a}
  .foot-text a{color:var(--accent);text-decoration:none}
  .foot-tech{display:flex;justify-content:center;gap:20px;margin-top:10px;font-family:'IBM Plex Mono',monospace;font-size:0.5rem;color:#2a2a40;letter-spacing:1px}
</style>
</head>
<body>
<div class="glow-orb glow-1"></div>
<div class="glow-orb glow-2"></div>

<div class="app">
  <nav class="nav">
    <div class="nav-brand">
      <div class="nav-logo"></div>
      <span class="nav-name">Voice Agent</span>
    </div>
    <span class="nav-badge">AI EMPLOYEE</span>
  </nav>

  <div class="hero">
    <div class="hero-badge">REAL-TIME VOICE AI</div>
    <h1>Talk to your<br>AI Employee</h1>
    <p>Upload your business knowledge. Hold the mic and ask anything. Get instant, accurate voice responses powered by your documents.</p>
  </div>

  <!-- Knowledge Base -->
  <div class="kb-card">
    <div class="kb-header">
      <span class="kb-title">Knowledge Base</span>
      <span class="kb-status empty" id="docStatus"><span class="dot"></span>NO DOCS</span>
    </div>
    <textarea class="kb-textarea" id="docInput" placeholder="Paste your business FAQ, policies, product info, pricing..."></textarea>
    <div class="kb-actions">
      <button class="btn btn-accent" id="uploadBtn" onclick="uploadDocs()">Load Documents</button>
    </div>
  </div>

  <!-- Chat -->
  <div class="chat" id="chatArea">
    <div class="chat-empty" id="chatEmpty">CONVERSATION WILL APPEAR HERE</div>
  </div>

  <!-- Mic -->
  <div class="mic-section">
    <div class="orb-container">
      <div class="mic-orb" id="micBtn" onmousedown="startRecording()" onmouseup="stopRecording()" ontouchstart="startRecording()" ontouchend="stopRecording()">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
          <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
          <line x1="12" y1="19" x2="12" y2="23"/>
          <line x1="8" y1="23" x2="16" y2="23"/>
        </svg>
      </div>
      <div class="orb-ring"></div>
      <div class="orb-ring-2"></div>
      <div class="orb-ring-3"></div>
    </div>
    <div class="mic-label" id="micStatus">HOLD TO SPEAK</div>
  </div>

  <!-- Text input -->
  <div class="input-bar">
    <input type="text" id="textInput" placeholder="Or type a question..." onkeydown="if(event.key==='Enter')sendText()">
    <button onclick="sendText()">Send</button>
  </div>

  <!-- Footer -->
  <div class="foot">
    <div class="foot-text">BUILT BY <a href="https://github.com/ajay-automates">AJAY KUMAR REDDY</a></div>
    <div class="foot-tech">
      <span>WHISPER STT</span>
      <span>GPT-4o</span>
      <span>OPENAI TTS</span>
      <span>LANGSMITH</span>
    </div>
  </div>
</div>

<script>
let mediaRecorder=null,audioChunks=[],isRecording=false;
const micBtn=document.getElementById('micBtn'),micStatus=document.getElementById('micStatus'),chatArea=document.getElementById('chatArea'),chatEmpty=document.getElementById('chatEmpty');

async function uploadDocs(){
  const text=document.getElementById('docInput').value.trim();
  if(!text)return;
  const btn=document.getElementById('uploadBtn');
  btn.disabled=true;btn.textContent='Loading...';
  try{
    const form=new FormData();form.append('text',text);
    const res=await fetch('/api/upload-text',{method:'POST',body:form});
    const data=await res.json();
    const st=document.getElementById('docStatus');
    st.innerHTML='<span class="dot"></span>READY ('+data.length+' chars)';
    st.className='kb-status loaded';
  }catch(e){
    document.getElementById('docStatus').innerHTML='<span class="dot"></span>ERROR';
  }
  btn.disabled=false;btn.textContent='Load Documents';
}

async function startRecording(){
  if(isRecording)return;
  try{
    const stream=await navigator.mediaDevices.getUserMedia({audio:true});
    mediaRecorder=new MediaRecorder(stream,{mimeType:'audio/webm'});
    audioChunks=[];
    mediaRecorder.ondataavailable=e=>{if(e.data.size>0)audioChunks.push(e.data)};
    mediaRecorder.start();
    isRecording=true;
    micBtn.classList.add('recording');
    micStatus.textContent='LISTENING...';
    micStatus.className='mic-label recording';
  }catch(e){micStatus.textContent='MIC ACCESS DENIED'}
}

async function stopRecording(){
  if(!isRecording||!mediaRecorder)return;
  isRecording=false;
  micBtn.classList.remove('recording');
  micBtn.classList.add('processing');
  micStatus.textContent='THINKING...';
  micStatus.className='mic-label processing';
  mediaRecorder.stop();
  mediaRecorder.onstop=async()=>{
    const audioBlob=new Blob(audioChunks,{type:'audio/webm'});
    mediaRecorder.stream.getTracks().forEach(t=>t.stop());
    await sendVoice(audioBlob);
    micBtn.classList.remove('processing');
    micStatus.textContent='HOLD TO SPEAK';
    micStatus.className='mic-label';
  };
}

async function sendVoice(audioBlob){
  const form=new FormData();
  form.append('audio',audioBlob,'recording.webm');
  try{
    const res=await fetch('/api/voice',{method:'POST',body:form});
    if(!res.ok){const err=await res.json();addMsg('agent','Error: '+(err.detail||'Something went wrong'));return}
    const userText=res.headers.get('X-User-Text')||'';
    const agentText=res.headers.get('X-Agent-Text')||'';
    const stt=res.headers.get('X-STT-Time')||'-';
    const llm=res.headers.get('X-LLM-Time')||'-';
    const tts=res.headers.get('X-TTS-Time')||'-';
    const total=res.headers.get('X-Total-Time')||'-';
    if(userText)addMsg('user',userText);
    addMsg('agent',agentText,'STT '+stt+'s  LLM '+llm+'s  TTS '+tts+'s  Total '+total+'s');
    const blob=await res.blob();
    new Audio(URL.createObjectURL(blob)).play();
  }catch(e){addMsg('agent','Connection error: '+e.message)}
}

async function sendText(){
  const inp=document.getElementById('textInput');
  const t=inp.value.trim();if(!t)return;inp.value='';
  addMsg('user',t);
  try{
    const form=new FormData();form.append('text',t);
    const res=await fetch('/api/text',{method:'POST',body:form});
    const d=await res.json();
    addMsg('agent',d.answer);
  }catch(e){addMsg('agent','Error: '+e.message)}
}

function addMsg(role,text,metrics){
  if(chatEmpty)chatEmpty.remove();
  const d=document.createElement('div');d.className='msg';
  const now=new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});
  let h='<div class="msg-head"><span class="msg-role '+role+'">'+(role==='user'?'YOU':'AI AGENT')+'</span><span class="msg-time">'+now+'</span></div>';
  h+='<div class="msg-body">'+esc(text)+'</div>';
  if(metrics)h+='<div class="msg-metrics"><span>'+metrics+'</span></div>';
  d.innerHTML=h;
  chatArea.appendChild(d);
  chatArea.scrollTop=chatArea.scrollHeight;
}

function esc(t){return t.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}
</script>
</body>
</html>
